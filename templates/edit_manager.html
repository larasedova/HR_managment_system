{% extends "base.html" %}

{% block content %}

<div class="form-container">
    <h2>Изменение начальника для: {{ employee.full_name }}</h2>
    <p>Текущая должность: {{ employee.position.title if employee.position else 'Не указана' }}</p>
    <p>Текущий начальник: {{ employee.manager.full_name if employee.manager else 'Нет начальника' }}</p>

    <form method="POST" action="{{ url_for('main_bp.update_manager', employee_id=employee.id) }}">
        <div class="form-group">
            <label for="manager_id">Выберите нового начальника:</label>
            <select name="manager_id" id="manager_id" required>
                <option value="">-- Нет начальника --</option>
                {% for emp in all_employees %}
                    <option value="{{ emp.id }}"
                            {% if emp.id == employee.manager_id %}selected{% endif %}
                            {% if emp.id == employee.id %}disabled{% endif %}>
                        {{ emp.full_name }}
                        ({{ emp.position.title if emp.position else 'Без должности' }})
                        {% if emp.id == employee.id %} - нельзя выбрать себя {% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-buttons">
            <button type="submit" class="btn-save">Сохранить изменения</button>
            <a href="{{ url_for('main_bp.index') }}" class="btn-cancel">Отмена</a>
        </div>
    </form>
</div>

<script>
console.log('Edit manager page loaded');

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded');
    const form = document.querySelector('form');
    const select = document.getElementById('manager_id');
    const saveButton = document.querySelector('.btn-save');
    const cancelButton = document.querySelector('.btn-cancel');

    console.log('Form:', form);
    console.log('Select:', select);
    console.log('Save button:', saveButton);
    console.log('Cancel button:', cancelButton);

    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('Form submitted');
            console.log('Selected manager ID:', select.value);
        });
    }
});
</script>

{% endblock %}